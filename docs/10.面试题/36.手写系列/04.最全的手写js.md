---
title: 最全的手写js
date: 2021-12-05 14:45:45
permalink: /pages/0233b5d06cbe5/
categories:
  - 面试题
  - 手写系列
tags:
  -
---

手写一定要重视！！！

<!-- more -->

## 实现一个 compose 函数

```js
// 用法如下:
function fn1(x) {
  return x + 1;
}
function fn2(x) {
  return x + 2;
}
function fn3(x) {
  return x + 3;
}
function fn4(x) {
  return x + 4;
}
const a = compose(fn1, fn2, fn3, fn4);
console.log(a(1)); // 1+4+3+2+1=11

// 就是把函数按倒序执行
function compose(...fn) {
  return fn.reduce(
    (pre, cur) => {
      return (...args) => {
        // 主要看题目是顺序执行，还是倒序执行
        return pre(cur(...args));
      };
    },
    (v) => v
  );
}
```

## 模拟实现 instanceof

```js
function myInstanceof(left, right) {
  //基本数据类型直接返回false
  if (typeof left !== "object" || left === null) return false;
  //getProtypeOf是Object对象自带的一个方法，能够拿到参数的原型对象
  let proto = Object.getPrototypeOf(left);
  while (true) {
    //查找到尽头，还没找到
    if (proto == null) return false;
    //找到相同的原型对象
    if (proto == right.prototype) return true;
    proto = Object.getPrototypeof(proto);
  }
}
```

<https://blog.shenzjd.com/pages/15beed3c2f8d4/#%E5%AE%9E%E7%8E%B0-instanceof-%E5%8A%9F%E8%83%BD>

## 多维数组拍平

```js
while (ary.some(Array.isArray)) {
  ary = [].concat(...ary);
}
```

<https://blog.shenzjd.com/pages/6bc4ef1017adc/>

## settimeout 模拟实现 setinterval

```js
function mySetinterVal(cb, delay) {
  setTimeout(() => {
    cb();
    mySetinterVal(cb, delay);
  }, delay);
}
mySetinterVal(() => {
  console.log(1);
}, 1000);
```

## setInterval 模拟实现 setTimeout

```js
function mySetTimeout(cb, delay) {
  const timer = setInterval(() => {
    cb();
    clearInterval(timer);
  }, delay);
}

mySetTimeout(() => {
  console.log(1);
}, 1000);
```

## 手写 call

```js
Function.prototype.call = function (context, ...args) {
  let context = context || window;
  context.fn = this;
  let res = context.fn(...args);
  delete context.fn;
  return res;
};
```

## 手写 apply

```js
Function.prototype.call = function (context, args) {
  let context = context || window;
  context.fn = this;
  let res = context.fn(...args);
  delete context.fn;
  return res;
};
```

## 手写 bind

```js
Function.prototype.bind = function (context, ...args) {
  if (typeof context !== "function") throw typeError();
  let that = this;
  let rfn = function () {
    that.call(context, ...args, arguments);
  };
  if (this.prototype) {
    rfn.prototype = Object.create(this.prototype);
  }
  return rfn;
};
```

## 手写 new

```js
function MyNew(ctor, ...args) {
  if (typeof ctor !== "function") throw " ctor must be a function";
  let obj = Object.create(ctor.prototype);
  // let obj = new Object();
  // obj.prototype = Object.create(ctor.prototype);
  let res = ctor.call(obj, ...args);
  let isObject = typeof res === "object" && res !== null;
  let isFunction = typeof res === "function";
  return isObject || isFunction ? res : obj;
}
```

## 正则模拟 trim 方法

```js
String.prototype.strim1 = function () {
  return this.replace(/(^\s+|\s+$)/g, "");
};
String.prototype.strim2 = function () {
  return this.replace(/^\s+(.*?)\s+$/g, "$1");
};

let str = "     dsfd    ";

console.log(str, 1);
console.log(str.trim(), 2);
console.log(str.strim1(), 3);
console.log(str.strim2(), 4);
```

## 手机号 3-4-4 分割

```js
const splitMobile = (mobile, format = "-") => {
  return String(mobile).replace(/(?=(\d{4})+$)/g, format);
};
console.log(splitMobile(13785241526));
```

## 手写一个深拷贝

<https://blog.shenzjd.com/pages/1e2e7dfe3b783/#%E5%AE%8C%E6%95%B4%E7%9A%84%E6%B7%B1%E6%8B%B7%E8%B4%9D>

## 千分位格式化数字

```js
const formatPrice = function (num) {
  console.log(num);
  const [integer, decimal = ""] = String(num).split(".");
  console.log(integer, decimal);
  return (
    integer.replace(/\B(?=(\d{3})+$)/g, ",") + (decimal ? "." + decimal : "")
  );
};

console.log(formatPrice(123456789.3343));
```

## 手写 Object.create

```js
const create = (prop, props) => {
  if (!["object", "function"].includes(typeof prop)) {
    throw new TypeError(
      `Object prototype may only be an Object or null: ${prop}`
    );
  }
  // 创建构造函数
  const Ctor = function () {};
  // 赋值原型
  Ctor.prototype = prop;
  // 创建实例
  const obj = new Ctor();
  // 支持第二个参数
  if (props) {
    Object.defineProperties(obj, props);
  }
  // 支持空原型
  if (prop === null) {
    obj.__proto__ = null;
  }

  return obj;
};

// 1. object.create常规使用
const person = {
  showName() {
    console.log(this.name);
  },
};
const me = Object.create(person);
const me2 = create(person);

me.name = "前端胖头鱼";
me2.name = "前端胖头鱼";

me.showName();
me2.showName();
// 2. 创建一个原型为null的空对象
const emptyObj = Object.create(null);
const emptyObj2 = create(null);

console.log(emptyObj);
console.log(emptyObj2);

// 3. propertiesObject参数

const props = {
  // foo会成为所创建对象的数据属性
  foo: {
    writable: true,
    configurable: true,
    value: "hello",
  },
  // bar会成为所创建对象的访问器属性
  bar: {
    configurable: false,
    get: function () {
      return 10;
    },
    set: function (value) {
      console.log("Setting `o.bar` to", value);
    },
  },
};

let o = Object.create(Object.prototype, props);
let o2 = create(Object.prototype, props);

o.bar = "前端胖头鱼";
o2.bar = "前端胖头鱼";

console.log(o.foo);
console.log(o.bar);

console.log(o2.foo);
console.log(o2.bar);
```

## 参考链接

- <https://github.com/qianlongo/fe-handwriting>
- <https://juejin.cn/post/6968713283884974088>
